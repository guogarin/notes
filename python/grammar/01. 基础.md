# 1. with语句
## 1.1 `with statement_1 as statement_2`是什么意思？
表示把`statement_1`的返回值赋给`statement_2`，比如对于：
```python
with open("test.txt") as f:
    ...
```
的意思就是把`open("test.txt")`的返回值赋给了`f`。

## 1.2 如何让对象支持 上下文管理协议(with语句)
有两种方法：
**(1) 标准做法：实现 `__enter__()` 和 `__exit__()` 方法**
为了让一个对象兼容 `with` 语句，需要实现`__enter__()` 和 `__exit__()` 方法：
> ` __enter__()`：它将在`with`出现的时候被触发，返回对象会赋给`as`声明的变量；
> `__exit__()` ： 他将在 离开`with`语句块时被触发，一般用它来进行清理工作。
> 
**(2) 使用`contextlib`**
具体例子见[类高级](10.%20类高级.md)





&emsp;
&emsp;
# 2. `datetime` 和 `time`
## 2.1 两者的区别和联系
&emsp;&emsp; 在Python中，`time`模块提供的是 更加接近于操作系统层面的 功能，而`datetime`是基于 `time` 进行了封装，提供了更多实用的函数。

## 2.2 建议使用哪个？
&emsp;&emsp; 因为`datetime`是基于 `time` 进行了封装，提供了更多实用的函数，所以`datetime`模块会更友好一些，尤其是在 不同时区之间进行转换的时候。





&emsp;
&emsp;
# 3. Python的序列化操作
## 3.1 `pickle`
### 3.1.1 `pickle`介绍
#### (1) `pickle`的作用是？
&emsp;&emsp; `pickle`提供的是 `二进制序列 <———> Python对象` 直接的转换操作：
> `pickle`可以把 python对象 保存为 硬盘上的二进制文件。 
> 在后面需要用到时，然后再次将对象加载到python中。
> 

#### (2) `pickle`的使用
pickle.dump() : 将Python对象转换为二进制
pickle.load() : 将字节流转换成Python对象
```python
import pickle

class GameState:
    def __init__(self):
        self.level = 0
        self.lives = 4

state = GameState()
state.level += 1 # Player beat a level
state.lives -= 1 # Player had to try again
print(state.__dict__)

# 写入
state_path = 'game_state.bin'
with open(state_path, 'wb') as f:
    pickle.dump(state, f)

# 读取
with open(state_path, 'rb') as f:
    state_after = pickle.load(f)    
print(state_after.__dict__)    
```
运行结果：
```
{'level': 1, 'lives': 3}
{'level': 1, 'lives': 3}
```

### 3.1.2 为什么需要`pickle`？
&emsp;&emsp; `pickle`提供的是一种数据持化的存储，可以把对象保存在文件中，即使关机了也能在下次开机时从对应的文件中取出来。

### 3.1.3 使用`pickle`时需要注意什么？
**(1) 不应该`pickle.load`不信任的数据**
&emsp;&emsp; `pickle`有安全隐患，经过`pickle`处理的字节流，只应该在 彼此信任的双方之间传输，我们不应该在公共网络中传输`pickle`流，因为这么做有可能被植入恶意代码，在接收端反序列化的时候被执行：
> pickle在加载时有一个副作用就是它会自动加载相应模块并构造实例对象。如果被有心人利用，那么系统会被植入恶意代码，因此，一定要保证pickle只在相互之间可以认证对方的解析器的内部使用。
> 
&emsp;&emsp; 而且`pickle`的本意是只提供一种数据传输的手段，让程序员可以在自己控制的程序之间传递二进制形式的对象。
**(2) 结合`copyreg`使用，给新属性默认值**
Effective Python里面有。

&emsp;
## 3.2 `json`
### 3.2.1 

&emsp;
## 3.3 `pickle` 和 `json`
JSON:
> 优点：跨语言(不同语言间的数据传递可用json交接)、体积小
> 缺点：只能支持int\str\list\tuple\dict
> 
Pickle:
> 优点：专为python设计，支持python所有的数据类型
> 缺点：只能在python中使用，存储数据占空间大
> 
> 
另外，它俩还有一个差异：JSON是人可读的(文本数据)，Pickle不可读(二进制数据)

