&emsp;
## 代理

### 1. 简介
&emsp;一般实现代理技术的方式就是在服务器上安装代理服务软件，让其成为一个代理服务器，从而实现代理技术。常用的代理技术分为**正向代理**、**反向代理**和**透明代理**。
代理分两种，一种是 **正向代理**，一种是 **反向代理**，**两者的区别在于代理的对象不一样：正向代理代理的对象是客户端，反向代理代理的对象是服务端**。
&emsp;&emsp;**正向代理** 指的是代理客户端，它隐藏了真实的请求客户端，服务端不知道真实的客户端是谁
&emsp;&emsp;**反向代理** 隐藏了真实的服务端，当我们请求 www.baidu.com 的时候，就像拨打10086一样，背后可能有成千上万台服务器为我们服务，但具体是哪一台，你不知道，也不需要知道，你只需要知道反向代理服务器是谁就好了，www.baidu.com 就是我们的反向代理服务器，反向代理服务器会帮我们把请求转发到真实的服务器那里去。


### 2. 正向代理
#### 2.1 定义
<div align="center"> <img src="./pic/代理/正向代理.jpg"> </div>
<center> <font color=black> <b> 图1 正向代理示意图 </b> </font> </center>

&emsp;&emsp;正向代理的过程，它隐藏了真实的请求客户端，服务端不知道真实的客户端是谁，客户端请求的服务都被代理服务器代替来请求，某些科学上网工具扮演的就是典型的正向代理角色。在国内用浏览器访问 http://www.google.com 时，于是你可以在国外搭建一台代理服务器proxy，让proxy帮你去请求google.com，proxy把请求返回的相应结构再返回给你。
&emsp;&emsp;**注意！** 此时google.com是不知道访问它的是你，他会认为访问它的是proxy，也就是说正向代理隐藏的是请求客户端。
#### 2.1 作用
正向代理服务器作用主要有以下几点：
##### (1) 访问本无法访问的服务器B
&emsp;&emsp;上面访问google.com的例子就是这个作用。
##### (2) 加速访问服务器B
<div align="center"> <img src="./pic/代理/使用代理服务器加速访问.jpg"> </div>
<center> <font color=black> <b> 图2 使用代理服务器加速访问 </b> </font> </center>

&emsp;&emsp;这种说法目前不像以前那么流行了，主要是带宽流量的飞速发展。早期的正向代理中，很多人使用正向代理就是提速。还是如图2中假设用户A到服务器B，经过R1路由器和R2路由器，而R1到R2路由器的链路是一个低带宽链路。而用户A到代理服务器Z，从代理服务器Z到服务器B都是高带宽链路。那么很显然就可以加速访问服务器B了。

##### (3) Cache作用
&emsp;&emsp;Cache（缓存）技术和代理服务技术是紧密联系的（不光是正向代理，反向代理也使用了Cache（缓存）技术。如图2 所示，如果在用户A访问服务器B某数据J之前，已经有人通过代理服务器Z访问过服务器B上得数据J，那么代理服务器Z会把数据J保存一段时间，如果有人正好取该数据J，那么代理服务器Z不再访问服务器B，而把缓存的数据J直接发给用户A。这一技术在Cache中术语就叫Cache命中。如果有更多的像用户A的用户来访问代理服务器Z，那么这些用户都可以直接从代理服务器Z中取得数据J，而不用千里迢迢的去服务器B下载数据了。

##### (4) 客户端访问授权
&emsp;&emsp;这方面的内容现今使用的还是比较多的，例如一些公司采用 ISA SERVER(一种可扩展的企业级防火墙) 做为正向代理服务器来授权用户是否有权限访问互联网。
<div align="center"> <img src="./pic/代理/客户端访问授权.jpg"> </div>
<center> <font color=black> <b> 图3 客户端访问授权 </b> </font> </center>

&emsp;&emsp;在图3中，防火墙作为网关，用来过滤外网对其的访问。假设用户A和用户B都设置了代理服务器，用户A允许访问互联网，而用户B不允许访问互联网（这个在代理服务器Z上做限制）这样用户A因为授权，可以通过代理服务器访问到服务器B，而用户B因为没有被代理服务器Z授权，所以不能访问服务器B。

##### (5) 隐藏访问者的行踪
&emsp;&emsp;从图2 中我们可以看出服务器B并不知道访问自己的实际是用户A，因为代理服务器Z代替用户A去直接与服务器B进行交互。如果代理服务器Z被用户A完全控制（或不完全控制），会惯以“肉鸡”术语称呼。

### 2.3 总结
&emsp;&emsp;正向代理是一个位于客户端和原始服务器(origin server)之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标(原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端。客户端必须设置正向代理服务器，当然前提是要知道正向代理服务器的IP地址，还有代理程序的端口。

### 3. 反向代理
#### 3.1 定义
&emsp;&emsp;**反向代理** 隐藏了真实的服务端，当我们请求 www.baidu.com 的时候，就像拨打10086一样，背后可能有成千上万台服务器为我们服务，但具体是哪一台，你不知道，也不需要知道，你只需要知道反向代理服务器是谁就好了，www.baidu.com 就是我们的反向代理服务器，反向代理服务器会帮我们把请求转发到真实的服务器那里去。Nginx就是性能非常好的反向代理服务器，用来做负载均衡。
#### 3.2 作用
使用反向代理服务器的作用如下：
##### (1) 保护和隐藏原始资源服务器
<div align="center"> <img src="./pic/代理/保护和隐藏原始资源服务器.jpg"> </div>
<center> <font color=black> <b> 图4 保护和隐藏原始资源服务器 </b> </font> </center>

&emsp;&emsp;用户A始终认为它访问的是原始服务器B而不是代理服务器Z，但实用际上反向代理服务器接受用户A的应答，从原始资源服务器B中取得用户A的需求资源，然后发送给用户A。由于防火墙的作用，只允许代理服务器Z访问原始资源服务器B。尽管在这个虚拟的环境下，防火墙和反向代理的共同作用保护了原始资源服务器B，但用户A并不知情。

##### (2) 负载均衡
<div align="center"> <img src="./pic/代理/负载均衡.jpg"> </div>
<center> <font color=black> <b> 图5 负载均衡 </b> </font> </center>

&emsp;&emsp;当反向代理服务器不止一个的时候，我们甚至可以把它们做成集群，当更多的用户访问资源服务器B的时候，让不同的代理服务器Z(x)去应答不同的用户，然后发送不同用户需要的资源。当然反向代理服务器像正向代理服务器一样拥有CACHE的作用，它可以缓存原始资源服务器B的资源，而不是每次都要向原始资源服务器B请求数据，特别是一些静态的数据，比如图片和文件，如果这些反向代理服务器能够做到和用户X来自同一个网络，那么用户X访问反向代理服务器X，就会得到很高质量的速度。


### 4. 透明代理
&emsp;&emsp;透明代理的意思是客户端根本不需要知道有代理服务器的存在，它改编你的 报文，并会传送真实IP。注意，加密的透明代理则是属于匿名代理，意思是不用设置使用代理了。
<div align="center"> <img src="./pic/代理/透明代理.jpg"> </div>
<center> <font color=black> <b> 图6 透明代理 </b> </font> </center>

&emsp;&emsp;如图6，用户A和用户B并不知道行为管理设备充当透明代理行为，当用户A或用户B向服务器A或服务器B提交请求的时候，透明代理设备根据自身策略拦截并修改用户A或B的报文，并作为实际的请求方，向服务器A或B发送请求，当接收信息回传，透明代理再根据自身的设置把允许的报文发回至用户A或B，如上图，如果透明代理设置不允许访问服务器B，那么用户A或者用户B就不会得到服务器B的数据。

